events {}

http {
    upstream identity_service {
        server identity:8001;
    }

    upstream pms_service {
        server pms:8002;
    }

    upstream billing_service {
        server billing:8003;
    }

    upstream reporting_service {
        server reporting:8004;
    }

    server {
        listen 80;

        location /auth {
            proxy_pass http://identity_service;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /users {
            proxy_pass http://identity_service;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /bookings {
            proxy_pass http://pms_service;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /hotel {
            proxy_pass http://pms_service;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /operations {
            proxy_pass http://pms_service;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        location /rooms {
            proxy_pass http://pms_service;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /billing/ {
            proxy_pass http://billing_service/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /reports/ {
            proxy_pass http://reporting_service/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /doc {
             # Getting docs from multiple services is tricky. 
             # Usually involves merging Swagger. 
             # For now, let's just default to PMS doc? or disable.
             return 404;
        }
    }
}
